browserext=function($,Modernizr){var browserext={mq:{xxs:function(){return Modernizr.mq("(max-width: 449px)")},xs:function(){return Modernizr.mq("(max-width: 767px)")},fromsm:function(){return Modernizr.mq("(min-width: 768px)")},sm:function(){return Modernizr.mq("(min-width: 768px) and (max-width: 980px)")},tosm:function(){return Modernizr.mq("(max-width: 980px)")},md:function(){return Modernizr.mq("(min-width: 981px) and (max-width: 1999px)")},fromsm:function(){return Modernizr.mq("(min-width: 981px)")},lg:function(){return Modernizr.mq("(min-width: 1200px)")}},touch:function(){return Modernizr.touchevents},touchMq:function(){return this.touch()&&this.mq.tosm()},mobile:{android:function(){return navigator.userAgent.match(/Android/i)},blackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return browserext.mobile.android()||browserext.mobile.blackBerry()||browserext.mobile.iOS()||browserext.mobile.opera()||browserext.mobile.windows()}},isIe:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:false},isIe8:function(){return jQuery("html").hasClass("lt-ie9")},isIe9:function(){return jQuery("html").hasClass("ie9")},getURLParam:function(strParamName){var strHref=window.location.href;var slug=strHref.split(/[?&]/);for(var i=1;i<slug.length;i++){if(slug[i].indexOf(strParamName+"=")>-1){var aParam=slug[i].split("=");return aParam[1]}}return""}};return browserext}(jQuery,Modernizr);
ClientData=function($,tracer){function ClientData(options){var defaults={readonly:false,initialData:{}};this.options=$.extend({},defaults,options);ClientStorage.call(this,this.options);this.load();var self=this;function unload(){if(self.options.readonly)return;tracer.message("ClientData::onunload",self);self.save()}if(window.addEventListener)window.addEventListener("unload",unload,false);else if(window.attachEvent)window.attachEvent("onunload",unload);else window.onunload=unload}ClientData.ENGINE_OPTIONS="tfd.engineoptions";ClientData.PLANNING_OPTIONS="tfd.planningoptions";ClientData.CUSTOMER="tfd.customer";ClientData.prototype=$.extend({},ClientStorage.prototype,{addDataSourceListener:function(key,dataCallback){var self=this;if(!key||!dataCallback)return;var listener=function(){var filteredModel=dataCallback();self.set(key,filteredModel);self.save()};if(window.addEventListener)window.addEventListener("unload",listener,false);else if(window.attachEvent)window.attachEvent("onunload",listener);else window.onunload=listener}});ClientData.prototype.constructor=ClientData;return ClientData}(jQuery,tracer);
ClientStorage=function($){function ClientStorage(options){var defaults={storagetype:ClientStorage.STORAGE_COOKIE,persistentData:[],nonPersistentData:[],initialData:{}};this.options=$.extend({},defaults,options);this._storage=null;this.data=this.options.initialData?$.extend({},this.options.initialData):{};var canUseBrowserStorage=testLocalStoragePermissions();if(!canUseBrowserStorage||this.options.storagetype==ClientStorage.STORAGE_COOKIE){this._storage=CookieStorage}else{this._storage=BrowserStorage}this.init(this.options.persistentData)}ClientStorage.STORAGE_BROWSER="STORAGE_BROWSER";ClientStorage.STORAGE_COOKIE="STORAGE_COOKIE";ClientStorage.prototype={init:function(keys){if(!keys)return;for(var k in keys){var key=keys[k];var loadedValue=this._storage.get(key);this.set(key,loadedValue)}},save:function(){if(!this.data)return;for(var key in this.data){if(!this.isPersistent(key))continue;var value=this.get(key);if(value===null)this._storage.reset(key);else this._storage.set(key,value)}},load:function(){if(!this.data)return;var loaded={};for(var key in this.data){var loadedValue=this._storage.get(key);loaded[key]=loadedValue}this.data=loaded},set:function(key,value){if(!key)return;this.data[key]=value},get:function(key){if(key in this.data)return this.data[key]},collection:function(){return this.data},reset:function(key){if(!key)return false;this.data[key]=null;delete this.data[key]},isPersistent:function(key){return this.options.persistentData.indexOf(key)>=0&&this.options.nonPersistentData.indexOf(key)<0}};BrowserStorage={storagetype:ClientStorage.STORAGE_BROWSER,set:function(key,value){if(typeof value=="undefined")return;if(typeof value=="function")return;var serValue=JSON.stringify(value);window.localStorage.setItem(key,serValue)},get:function(key){var value=window.localStorage.getItem(key);if(!value)return value;return JSON.parse(value)},reset:function(key){window.localStorage.removeItem(key)}};CookieStorage={storagetype:ClientStorage.STORAGE_COOKIE,set:function(key,value){var strValue=JSON.stringify(value);var expires=new Date((new Date).setYear((new Date).getFullYear()+1));document.cookie=key+"="+strValue+";path=/; expires="+expires.toString()+";"},get:function(key){var keyEQ=key+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1,c.length);if(c.indexOf(keyEQ)==0){var value=c.substring(keyEQ.length,c.length);return value&&JSON.parse(value)}}return null},reset:function(key){document.cookie=key+"=; expires=Thu, 01-Jan-70 00:00:01 GMT;"}};function testLocalStoragePermissions(){if("localStorage"in window){try{window.localStorage.setItem("_tmptest","tmpval");window.localStorage.removeItem("_tmptest");return true}catch(BogusQuotaExceededErrorOnIos5){}}return false}return ClientStorage}(jQuery);
browserext=function($,Modernizr){var browserext={mq:{xxs:function(){return Modernizr.mq("(max-width: 449px)")},xs:function(){return Modernizr.mq("(max-width: 767px)")},fromsm:function(){return Modernizr.mq("(min-width: 768px)")},sm:function(){return Modernizr.mq("(min-width: 768px) and (max-width: 980px)")},tosm:function(){return Modernizr.mq("(max-width: 980px)")},md:function(){return Modernizr.mq("(min-width: 981px) and (max-width: 1999px)")},fromsm:function(){return Modernizr.mq("(min-width: 981px)")},lg:function(){return Modernizr.mq("(min-width: 1200px)")}},touch:function(){return Modernizr.touchevents},mobile:function(){return browserext.android()||browserext.blackberry()||browserext.ios()||browserext.operamini()||browserext.winmobile()},webos:function(){return navigator.userAgent.match(/webOS/i)},android:function(){return navigator.userAgent.match(/Android/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},opera:function(){return navigator.userAgent.match(/OPR\/(\d+\.\d+)/i)},operamini:function(){return navigator.userAgent.match(/Opera Mini/i)},chrome:function(){return navigator.userAgent.match(/Chrome/i)},firefox:function(){return navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/i)},safari:function(){return navigator.userAgent.match(/Safari\/(\d+\.\d+)/i)},winmobile:function(){return navigator.userAgent.match(/IEMobile/i)},winos:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)||navigator.userAgent.match(/Windows Phone/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},ie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},ieversion:function(){var match=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/);return match?parseInt(match[1]):void 0},ie8:function(){var ieversion=this.ieversion();return ieversion&&8==ieversion},ie9:function(){var ieversion=this.ieversion();return ieversion&&9==ieversion},lang:function(){var lang=window.navigator.userLanguage||window.navigator.language;return-1!==lang.indexOf("-")&&(lang=lang.split("-")[0]),-1!==lang.indexOf("_")&&(lang=lang.split("_")[0]),lang=lang.toUpperCase()},injectClasses:function(selector){selector=selector||"html";var classes=[],agents={ie:this.ie(),ios:this.ios(),winos:this.winos(),winmobile:this.winmobile(),safari:this.safari(),firefox:this.firefox(),chrome:this.chrome(),operamini:this.operamini(),"agent-opera":this.opera(),"agent-blackberry":this.blackberry(),"agent-android":this.android(),"agent-webos":this.webos()};for(var a in agents)if(agents.hasOwnProperty(a)){var agent=agents[a];if(agent){var agentClass="agent-"+a,agentVersion=agent.length>1?"-"+agent[1]:"";"ie"==agent&&(agentVersion=this.ieversion()),classes.push(agentClass+agentVersion)}}classes.push("lang-"+this.lang()),classes.push(this.mobile()?"mobile":"no-mobile"),classes.push(this.touch()?"touch":"no-touch");var classesString=classes.join(" ");return $(selector).addClass(classesString),classesString},urlHash:function(url){return url?url.indexOf("#")>=0?url.split("#")[1]:url:window.location.hash},urlSearch:function(url){return url?url.indexOf("?")>=0?url.split(/[?#]/)[1]:url:window.location.search},urlPath:function(url){var path=url?url.split(/[?#]/)[0]:window.location.pathname;return path=path&&"/"==path[0]?path.substring(1):path,path=path&&"/"==path[path.length-1]?path.substring(0,path.length-1):path},breadcrumb:function(url){var path=this.urlPath(url);return""!=path?path.split("/"):[]},eParam:function(param,str){if(!param||!str)return null;for(var params=str.split(/[&]/),i=1;i<params.length;i++){var aParam=params[i].split("="),key=aParam[0],value=decodeURI(aParam[1]);if(key==param)return value.indexOf("|")<0?value:value.split("|")}return null},eParams:function(str){if(str){for(var params=str.split(/[&]/),oParams={},i=1;i<params.length;i++){var aParam=params[i].split("="),key=aParam[0],value=decodeURI(aParam[1]);oParams[key]=value.indexOf("|")<0?value:value.split("|")}return oParams}},eParamsToString:function(eParams){if(!eParams)return"";var params=[];for(var key in eParams)if(eParams.hasOwnProperty(key)){var rawValue=eParams[key],value=Array.isArray(rawValue)?rawValue.join("|"):rawValue;params.push(key+"="+value)}return params.join("&")},hashParams:function(url){var hash=this.urlHash(url),hashParams=this.eParams(hash);return hashParams},searchParams:function(url){var search=this.urlSearch(url),searchParams=this.eParams(search);return searchParams},param:function(param,url){var hash=this.urlHash(url),search=this.urlSearch(url),hashValue=this.eParam(param,hash),searchValue=this.eParam(param,search);return searchValue||hashValue},paramHas:function(param,value,url){var paramValue=this.param(param);return paramValue&&Array.isArray(paramValue)?paramValue.indexOf(value)>=0:paramValue==value},paramSet:function(param,value,url,mode){if(param){mode=mode||"#";var urlHash=this.urlHash(url),urlSearch=this.urlSearch(url),urlPath=this.urlPath(url);if("#"==mode){var oHash=this.eParams(urlHash);oHash[param]=value,urlHash=this.eParamsToString(oHash)}else if("?"==mode){var oSearch=this.eParams(urlSearch);oSearch[param]=value,urlSearch=this.eParamsToString(oSearch)}return urlPath+"?"+urlSearch+"#"+urlHash}},valueToggle:function(oldValue,toggle){if(!oldValue)return toggle||"1";if(null!=toggle)return Array.isArray(oldValue)?(oldValue.push(toggle),oldValue):[toggle];switch(oldValue){case"0":return"1";case"false":return"true";case"true":return"false";case"1":return"0"}},paramToggle:function(param,value,url,mode){if(param){mode=mode||"#";var urlHash=this.urlHash(url),urlSearch=this.urlSearch(url),urlPath=this.urlPath(url);if("#"==mode){var oHash=this.eParams(urlHash);oHash[param]=this.valueToggle(oHash[param],value),urlHash=this.eParamsToString(oHash)}else if("?"==mode){var oSearch=this.eParams(urlSearch);oSearch[param]=this.valueToggle(oHash[param],value),urlSearch=this.eParamsToString(oSearch)}return urlPath+"?"+urlSearch+"#"+urlHash}}};return browserext}(jQuery,Modernizr);
var DataManager=function($,tracer,ClientData){var _DATA={};_DATA.CUSTOMER_MAIL="CustomerMail";var _defaultoptions={mapping:{}};_defaultoptions.mapping[_DATA.CUSTOMER_MAIL]="tf.customermail";function DataManager(options){this.options=$.extend({},_defaultoptions,options);this.gtm=this.options.gtm||[];this.data=new ClientData({persistentData:[_defaultoptions.mapping[_DATA.CUSTOMER_MAIL]]});this.options.mapping=build2WaysMapping(this.options.mapping)}DataManager.prototype={DATA:_DATA,connection:function(gtm){if(gtm!=null)this.gtm=gtm;return this.gtm},set:function(property,value,safemode){safemode=safemode!=null?safemode:true;if(!property)return false;var validvalue=value!=""&&value!=null&&value!="0";if(safemode&&!validvalue)return false;var mapped=mapKey(property,this.options.mapping);this.data.set(mapped,value);return true},setValid:function(property,value){var safemode=true;return this.set(property,value,safemode)},setValidObject:function(obj){for(var key in obj){if(!obj.hasOwnProperty(key))continue;this.setValid(key,obj[key])}},get:function(property){var mapped=mapKey(property,this.options.mapping);var value=this.data.get(mapped);return value},reset:function(property){this.data.reset()},push:function(event,infos){var datainfo=pickInfos(this.data.collection(),infos);if(!datainfo)return false;datainfo.event=event;var infomapped=mapNames(datainfo,this.options.mapping);var infocleaned=cleanInfo(infomapped);tracer.comm("DataManager::gtm : ",infocleaned);this.gtm.push(infocleaned)}};DataManager.prototype.constructor=DataManager;function mapNames(source,mapping){if(!source||!mapping)return source;var converted=Object.keys(source).reduce(function(model,key){model[mapKey(key,mapping)]=source[key];return model},{});return converted}function mapKey(key,mapping){return mapping&&mapping[key]||key}function pickInfos(source,infos){if(!infos)return $.extend({},source);var picked=Object.keys(source).reduce(function(model,key){if(source[key]!=null&&infos.indexOf(key)>=0)model[key]=source[key];return model},{});return picked}function cleanInfo(source){var cleaned=Object.keys(source).reduce(function(model,key){if(source[key]!=null)model[key]=source[key];return model},{});return cleaned}function build2WaysMapping(mapping){var m2w={};for(var key in mapping){if(!mapping.hasOwnProperty(key))continue;var value=mapping[key];m2w[key]=value;m2w[value]=key}return m2w}return new DataManager}(jQuery,tracer,ClientData);