ClientStorage=function($){function ClientStorage(options){var defaults={storagetype:ClientStorage.STORAGE_COOKIE,persistentData:[],nonPersistentData:[],initialData:{}};this.options=$.extend({},defaults,options),this._storage=null,this.data=this.options.initialData?$.extend({},this.options.initialData):{};var canUseBrowserStorage=testLocalStoragePermissions();canUseBrowserStorage&&this.options.storagetype!=ClientStorage.STORAGE_COOKIE?this._storage=BrowserStorage:this._storage=CookieStorage,this.init(this.options.persistentData)}function testLocalStoragePermissions(){if("localStorage"in window)try{return window.localStorage.setItem("_tmptest","tmpval"),window.localStorage.removeItem("_tmptest"),!0}catch(BogusQuotaExceededErrorOnIos5){}return!1}return ClientStorage.STORAGE_BROWSER="STORAGE_BROWSER",ClientStorage.STORAGE_COOKIE="STORAGE_COOKIE",ClientStorage.prototype={init:function(keys){if(keys)for(var k in keys){var key=keys[k],loadedValue=this._storage.get(key);this.set(key,loadedValue)}},save:function(){if(this.data)for(var key in this.data)if(this.isPersistent(key)){var value=this.get(key);null===value?this._storage.reset(key):this._storage.set(key,value)}},load:function(){if(this.data){var loaded={};for(var key in this.data){var loadedValue=this._storage.get(key);loaded[key]=loadedValue}this.data=loaded}},set:function(key,value){key&&(this.data[key]=value)},get:function(key){return key in this.data?this.data[key]:void 0},collection:function(){return this.data},reset:function(key){return key?(this.data[key]=null,void delete this.data[key]):!1},isPersistent:function(key){return this.options.persistentData.indexOf(key)>=0&&this.options.nonPersistentData.indexOf(key)<0}},BrowserStorage={storagetype:ClientStorage.STORAGE_BROWSER,set:function(key,value){if("undefined"!=typeof value&&"function"!=typeof value){var serValue=JSON.stringify(value);window.localStorage.setItem(key,serValue)}},get:function(key){var value=window.localStorage.getItem(key);return value?JSON.parse(value):value},reset:function(key){window.localStorage.removeItem(key)}},CookieStorage={storagetype:ClientStorage.STORAGE_COOKIE,set:function(key,value){var strValue=JSON.stringify(value),expires=new Date((new Date).setYear((new Date).getFullYear()+1));document.cookie=key+"="+strValue+";path=/; expires="+expires.toString()+";"},get:function(key){for(var keyEQ=key+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(keyEQ)){var parsedValue,value=c.substring(keyEQ.length,c.length);try{parsedValue=JSON.parse(value)}catch(e){parsedValue=value}return parsedValue}}return null},reset:function(key){document.cookie=key+"=; expires=Thu, 01-Jan-70 00:00:01 GMT;"}},ClientStorage}(jQuery);