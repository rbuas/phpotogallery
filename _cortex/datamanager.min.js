var DataManager=function($,tracer,ClientData){function DataManager(options){this.options=$.extend({},_defaultoptions,options),this.gtm=this.options.gtm||[],this.data=new ClientData({persistentData:[_defaultoptions.mapping[_DATA.CUSTOMER_MAIL]]}),this.options.mapping=build2WaysMapping(this.options.mapping)}function mapNames(source,mapping){if(!source||!mapping)return source;var converted=Object.keys(source).reduce(function(model,key){return model[mapKey(key,mapping)]=source[key],model},{});return converted}function mapKey(key,mapping){return mapping&&mapping[key]||key}function pickInfos(source,infos){if(!infos)return $.extend({},source);var picked=Object.keys(source).reduce(function(model,key){return null!=source[key]&&infos.indexOf(key)>=0&&(model[key]=source[key]),model},{});return picked}function cleanInfo(source){var cleaned=Object.keys(source).reduce(function(model,key){return null!=source[key]&&(model[key]=source[key]),model},{});return cleaned}function build2WaysMapping(mapping){var m2w={};for(var key in mapping)if(mapping.hasOwnProperty(key)){var value=mapping[key];m2w[key]=value,m2w[value]=key}return m2w}var _DATA={};_DATA.CUSTOMER_MAIL="CustomerMail";var _defaultoptions={mapping:{}};return _defaultoptions.mapping[_DATA.CUSTOMER_MAIL]="tf.customermail",DataManager.prototype={DATA:_DATA,connection:function(gtm){return null!=gtm&&(this.gtm=gtm),this.gtm},set:function(property,value,safemode){if(safemode=null!=safemode?safemode:!0,!property)return!1;var validvalue=""!=value&&null!=value&&"0"!=value;if(safemode&&!validvalue)return!1;var mapped=mapKey(property,this.options.mapping);return this.data.set(mapped,value),!0},setValid:function(property,value){var safemode=!0;return this.set(property,value,safemode)},setValidObject:function(obj){for(var key in obj)obj.hasOwnProperty(key)&&this.setValid(key,obj[key])},get:function(property){var mapped=mapKey(property,this.options.mapping),value=this.data.get(mapped);return value},reset:function(property){this.data.reset()},push:function(event,infos){var datainfo=pickInfos(this.data.collection(),infos);if(!datainfo)return!1;datainfo.event=event;var infomapped=mapNames(datainfo,this.options.mapping),infocleaned=cleanInfo(infomapped);tracer.comm("DataManager::gtm : ",infocleaned),this.gtm.push(infocleaned)}},DataManager.prototype.constructor=DataManager,new DataManager}(jQuery,tracer,ClientData);